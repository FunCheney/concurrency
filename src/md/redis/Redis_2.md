### Redis面试问题

#### 项目哪里用了缓存？为什么要用缓存？用缓存有没有什么问题？



#### Redis数据的并发竞争如何解决？
&ensp;&ensp;某个时刻，多个系统同时去更新某个Key；系统中如果有这种情况，解决方案就是基于zookeeper使用分布式锁。

&ensp;&ensp;分布式锁确保同一时间只能有一个实例在操作某个key，别人都不允许读和写。

&ensp;&ensp；每次要写之前判断一下当前value的时间戳，是否比缓存里的时间戳更新。当前时间更新就更新，否则就不更新。(CAS)


#### Redis缓存一致性问题？

##### Cache Aside Pattern
&ensp;&ensp;1.读数据的时候先读缓存，缓存没有的话，就读数据库。饭后读取数据放入缓存，同时返回响应。

&ensp;&ensp;2.更新数据的时候，先删除缓存，跟新数据库。缓存需要的时候才会加载，符合Reids的LRU设计策略。其次，缓存是在内存中使用的，如果本次更新缓存之后能不能用到还两说，这样不一定是有用数据，占用内存。

##### 缓存不一致性的解决方案
* 1.最初的缓存不一致问题与解决方案

&ensp;&ensp;问题: 先修改数据，再删除缓存，如果删除缓存失败了，那么会导致数据库中的数据更新了，缓存中的是旧数据。

&ensp;&ensp;解决思路：先删除缓存，再修改数据库，如果删除缓存失败了，那么数据库中是旧数据，缓存中是空的，那么数据不会不一致。因为读数据时缓存中没有，则读数据库中旧数据，然后跟新到缓存中。 
 
* 2.复杂的数据不一致问题分析

&ensp;&ensp;问题：先修改数据，在删除缓存的时候可能会有如下问题。先删除缓存，然后在修改数据库；此时还没修改，一个请求过来，去读缓存，发现缓存空了，去查询数据库，查到了修改前的久数据，放到缓存中。然后，数据更新的程序完成了数据库的修改。

&ensp;&ensp;解决方案：缓存的读取和数据库的更新串行化。

跟新数据的时候，根据唯一标识，将操作路由，将对于同一标识缓存的操作放置到内存队列中去，一个队列对应一个工作线程。每个工作线程拿到对应的操作，然后一条一条的去执行。这样的话，一个数据变更的操作，先执行，删除缓存，然后再去更新数据库，但是还没更新完成。此时如果一个读请求过来，读到了缓存中为空，那么可以先将缓存更新的请求发送到队列中，等上一个队列中的操作完成。









